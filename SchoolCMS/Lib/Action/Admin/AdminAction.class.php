<?php/*** *	copyright	:	Copyright (c) 2007-2013 SchoolCMS Inc. (http://www.schoolcms.cn/) *	license		:	http://www.schoolcms.cn/ *	ContactQQ	:	1655098383 *	E-mail		:	386392432@qq.com *	您可以在完全遵守本许可协议的基础上，将本软件应用于非商业用途，而不必支付软件版权许可费用。 ***/ if(!$_SESSION['schoolcms_admin']['aname']) Header('Location:'.__ROOT__.'/admin.php?action=login');class AdminAction extends CommonAction{	public function Index() {}		/*		添加和编辑管理员共用input:text模块方法	*/	private function InitializationInfo($AdminDataArray = array(), $PwdVerification = 1, $Ban = 0)	{		if(false == empty($AdminDataArray['aname'])) {			$AName = $AdminDataArray['aname'];		} else {			$AName = null;		}		$Name = array(			'textname' => '管理员名称：',			'name' => 'aname',			'prompt' => '输入管理员名称',			'prompttype' => 1,			'lengthsmall' => 3,			'lengthlarge' => 6,			'required' => 1,			'classname' => 'addinputtext',			'default' => $AName,			'ban' => $Ban,			'mousedown' => '请输入3至6位之间的字符！',		);		$NameObj = new InputTextModel($Name);		$this->assign('aname', $NameObj->GetInputTextHtmlInfo());				$Pwd = array(			'textname' => '管理员密码：',			'name' => 'apwd',			'prompt' => '输入管理员密码',			'prompttype' => $PwdVerification,			'lengthsmall' => 6,			'lengthlarge' => 12,			'required' => $PwdVerification,			'classname' => 'addinputtext',			'type' => 'password',			'mousedown' => '请输入6至12位之间的字符！',		);		$PwdObj = new InputTextModel($Pwd);		$this->assign('apwd', $PwdObj->GetInputTextHtmlInfo());				if(false == empty($AdminDataArray['amobile'])) {			$AMobile = $AdminDataArray['amobile'];		} else {			$AMobile = null;		}		$Mobile = array(			'textname' => '管理员手机：',			'name' => 'amobile',			'prompt' => '输入管理员手机',			'prompttype' => 1,			'verificationtype' => 2,			'required' => 1,			'classname' => 'addinputtext',			'default' => $AMobile,			'mousedown' => '请输入11位纯数字！',		);		$MobileObj = new InputTextModel($Mobile);		$this->assign('amobile', $MobileObj->GetInputTextHtmlInfo());				if(false == empty($AdminDataArray['amail'])) {			$AMail = $AdminDataArray['amail'];		} else {			$AMail = null;		}		$Mail = array(			'textname' => '管理员邮箱：',			'name' => 'amail',			'prompt' => '输入管理员邮箱',			'prompttype' => 1,			'verificationtype' => 4,			'required' => 1,			'classname' => 'addinputtext',			'default' => $AMail,			'mousedown' => '请输入常用邮箱、格式如:386392432@qq.com',		);		$MailObj = new InputTextModel($Mail);		$this->assign('amail', $MailObj->GetInputTextHtmlInfo());				if(false == empty($AdminDataArray['anick'])) {			$ANick = $AdminDataArray['anick'];		} else {			$ANick = null;		}		$Nick = array(			'textname' => '管理员昵称：',			'name' => 'anick',			'prompt' => '输入管理员昵称',			'prompttype' => 1,			'lengthsmall' => 2,			'lengthlarge' => 8,			'required' => 1,			'classname' => 'addinputtext',			'default' => $ANick,			'mousedown' => '请输入2至8位之间的字符！',		);		$NickObj = new InputTextModel($Nick);		$this->assign('anick', $NickObj->GetInputTextHtmlInfo());				if(false == empty($AdminDataArray['afullname'])) {			$AFullName = $AdminDataArray['afullname'];		} else {			$AFullName = null;		}		$FullName = array(			'textname' => '管理员姓名：',			'name' => 'afullname',			'prompt' => '输入管理员姓名',			'prompttype' => 1,			'lengthsmall' => 2,			'lengthlarge' => 8,			'required' => 1,			'classname' => 'addinputtext',			'default' => $AFullName,			'mousedown' => '请输入2至8位之间的字符！',		);		$FullNameObj = new InputTextModel($FullName);		$this->assign('afullname', $FullNameObj->GetInputTextHtmlInfo());	}		/*		管理员写入方法	*/	public function AdminWrite()	{		if('add' == empty($_POST['type'])) {			if(true == empty($_POST['aname'])) {				$this->SchoolCMSPrompt('管理员名称不能为空！');			}		}		if('add' == empty($_POST['type'])) {			if(true == empty($_POST['apwd'])) {				$this->SchoolCMSPrompt('管理员密码不能为空！');			}		}		if(true == empty($_POST['anick'])) {			$this->SchoolCMSPrompt('昵称不能为空！');		}		if(true == empty($_POST['afullname'])) {			$this->SchoolCMSPrompt('姓名不能为空！');		}		if(true == empty($_POST['amobile'])) {			$this->SchoolCMSPrompt('手机不能为空！');		}		if(true == empty($_POST['amail'])) {			$this->SchoolCMSPrompt('邮箱不能为空！');		}				$Admin = M('admin');		if('editor' == $_POST['type']) {			if(false == empty($_POST['apwd'])) {				$_POST['apwd'] = md5($_POST['apwd']);			} else {				unset($_POST['apwd']);			}			//echo'<pre>';print_r($_POST);exit();			$Statu = $Admin->where('aid='.$_POST['aid'])->setField($_POST);			$Content = '恭喜编辑成功！';		}				if('add' == $_POST['type']) {			$_POST['apwd'] = md5($_POST['apwd']);			$Statu = $Admin->add($_POST);			$Content = '恭喜新增成功！';		}		if($Statu) {			$this->SchoolCMSPrompt($Content);		} else {			$this->SchoolCMSPrompt('操作失败');		}	}		/*		添加管理员	*/	public function AddAdminInfo()	{		$this->InitializationInfo();				$this->assign('type', 'add');		$this->assign('aid', null);		$this->display('Admin/addadmin');	}		/*		Ajax验证管理员是否已经存在	*/	public function AjaxAdminName()	{		if(false == empty($_POST['aname'])) {			$Admin = M('admin');			$Condition = array('aname' => $_POST['aname']);							// 把查询条件传入查询方法			$AdminData = $Admin->where($Condition)->select();			//判断返回是否有数据			if(false == empty($AdminData)) {				echo 1;			} else {				echo 0;			}		}	}		/*		管理员编辑	*/	public function AdminEditor()	{		$Admin = M('admin');		$AdminData = $Admin->select($_SESSION['schoolcms_admin']['aid']);		$this->InitializationInfo($AdminData[0], 10, 1);		$this->assign('type', 'editor');		$this->assign('aid', $AdminData[0]['aid']);				$this->display('Admin/addadmin');	}		}?>